<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>itielectricidad</title>
    <!-- Importar Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.x.x/firebase-database.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA-QOiNqn1UUEmAU5xdp5Ezdjc68iLsFQU",
            authDomain: "iti-electricidad-ae0b5.firebaseapp.com",
            databaseURL: "https://iti-electricidad-ae0b5-default-rtdb.firebaseio.com",
            projectId: "iti-electricidad-ae0b5",
            storageBucket: "iti-electricidad-ae0b5.appspot.com",
            messagingSenderId: "248405714893",
            appId: "1:248405714893:web:98609ab75ce3feb8a70684",
            measurementId: "G-TBLGPR5066"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Función para actualizar el estado del dispositivo
        function updateDeviceState(device, state) {
            set(ref(database, 'devices/' + device), {
                state: state
            }).then(() => {
                console.log(`Estado actualizado para el dispositivo ${device}: ${state}`);
            }).catch((error) => {
                console.error('Error al actualizar el estado: ', error);
            });
        }

        // Escuchar cambios en la base de datos
        onValue(ref(database, 'devices'), (snapshot) => {
            const devices = snapshot.val();
            console.log('Cambio detectado en la base de datos', devices);
            if (devices) {
                for (const device in devices) {
                    const state = devices[device].state;
                    document.getElementById('boton' + device).checked = state; // Asegúrate de que los IDs coincidan
                }
            }
        });

        // Manejo de eventos para los checkboxes
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('input[type="checkbox"]').forEach((checkbox) => {
                checkbox.addEventListener('change', (event) => {
                    const deviceId = event.target.id.replace('boton', '');
                    const newState = event.target.checked;
                    updateDeviceState(deviceId, newState);
                });
            });
        });
    </script>
</head>
<body>
    <section class="inicio">
        <div class="colegio"><h1>Institución Educativa Aureliano Florez Cardona</h1></div>
        <div class="escudo"><img id="escudo" class="escudo" src="escugo.jpg" alt="escudo.jpg"></div>
    </section>
    <div class="marquee">
        <marquee direction="lefth">Clase de electricidad domotica ITI</marquee>
    </div>
    
    <section class="flex-container"> Selecciona el dispositivo a encender
        <div class="caja">
            Elemento1
            <label class="switch">
                <input type="checkbox" id="boton1">
                <span class="slider"></span>
            </label>
            <img class="lamp1" id="imagen1" src="imagen1.jpg" alt="Imagen 1"> 
        </div>
        
        <div class="caja1">
            Elemento2
            <label class="switch">
                <input type="checkbox" id="boton2">
                <span class="slider"></span>
            </label>
            <img class="lamp2" id="imagen2" src="imagen2.jpg" alt="Imagen 2">
        </div>
      
        <div class="caja3">
            Elemento3
            <label class="switch">
                <input type="checkbox" id="boton3">
                <span class="slider"></span>
            </label>
            <img class="lamp1" id="imagen3" src="imagen3.jpg" alt="Imagen 3">
        </div>

        <div class="caja4">
            Elemento4
            <label class="switch">
                <input type="checkbox" id="boton4">
                <span class="slider"></span>
            </label>
            <img class="gato" id="imagen7" src="imagen7.gif" alt="Imagen 7">
        </div>
    </section>
  
   <section>
       <div class="parent">
           <img class="electrico" src="electrico.gif" alt="">
           <div class="child"> Vuélvete un técnico electricista en redes comerciales y residenciales. 
           </div>
       </div>
   </section>     
</body>
</html>
